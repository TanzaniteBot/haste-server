class haste_document{constructor(t){this.locked=!1,this.app=t}htmlEscape(t){return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}load(t,e,s){$.ajax(this.app.baseUrl+"documents/"+t,{type:"get",dataType:"json",success:i=>{this.locked=!0,this.key=t,this.data=i.data;try{var o;o="txt"===s?{value:this.htmlEscape(i.data)}:s?hljs.highlight(i.data,{language:s}):hljs.highlightAuto(i.data)}catch(t){o=hljs.highlightAuto(i.data)}e({value:o.value,key:t,language:o.language||s,lineCount:i.data.split("\n").length})},error:()=>{e(!1)}})}save(t,e){if(this.locked)return!1;this.data=t,$.ajax(this.app.baseUrl+"documents",{type:"post",data:t,dataType:"json",contentType:"text/plain; charset=utf-8",success:s=>{this.locked=!0,this.key=s.key;let i=hljs.highlightAuto(t);e(null,{value:i.value,key:s.key,language:i.language,lineCount:t.split("\n").length})},error:t=>{try{e($.parseJSON(t.responseText))}catch(t){e({message:"Something went wrong!"})}}})}}class haste{static extensionMap={rb:"ruby",py:"python",pl:"perl",php:"php",scala:"scala",go:"go",xml:"xml",html:"xml",htm:"xml",css:"css",js:"javascript",vbs:"vbscript",lua:"lua",pas:"delphi",java:"java",cpp:"cpp",cc:"cpp",m:"objectivec",vala:"vala",sql:"sql",sm:"smalltalk",lisp:"lisp",ini:"ini",diff:"diff",bash:"bash",sh:"bash",tex:"tex",erl:"erlang",hs:"haskell",md:"markdown",txt:"",coffee:"coffee",swift:"swift"};constructor(t,e){this.appName=t,this.$textarea=$("textarea"),this.$box=$("#box"),this.$code=$("#box code"),this.$linenos=$("#linenos"),this.options=e,this.configureShortcuts(),this.configureButtons(),e.twitter||$("#box2 .twitter").hide(),this.baseUrl=e.baseUrl||"/"}setTitle(t){let e=t?this.appName+" - "+t:this.appName;document.title=e}showMessage(t,e){let s=$('<li class="'+(e||"info")+'">'+t+"</li>");$("#messages").prepend(s),setTimeout(()=>{s.slideUp("fast",function(){$(this).remove()})},3e3)}lightKey(){this.configureKey(["new","save"])}fullKey(){this.configureKey(["new","duplicate","twitter","raw"])}configureKey(t){let e;$("#box2 .function").each(function(){e=$(this);for(let s=0;s<t.length;s++)if(e.hasClass(t[s]))return e.addClass("enabled"),!0;e.removeClass("enabled")})}newDocument(t){this.$box.hide(),this.doc=new haste_document(this),t||window.history.pushState(null,this.appName,this.baseUrl),this.setTitle(),this.lightKey(),this.$textarea.val("").show("fast",function(){this.focus()}),this.removeLineNumbers()}lookupExtensionByType(t){for(let e in haste.extensionMap)if(haste.extensionMap[e]===t)return e;return t}lookupTypeByExtension(t){return haste.extensionMap[t]||t}addLineNumbers(t){let e="";for(let s=0;s<t;s++)e+=(s+1).toString()+"<br/>";$("#linenos").html(e)}removeLineNumbers(){$("#linenos").html("&gt;")}loadDocument(t){let e=t.split(".",2);this.doc=new haste_document(this),this.doc.load(e[0],t=>{t?(this.$code.html(t.value),this.setTitle(t.key),this.fullKey(),this.$textarea.val("").hide(),this.$box.show().focus(),this.addLineNumbers(t.lineCount)):this.newDocument()},this.lookupTypeByExtension(e[1]))}duplicateDocument(){if(this.doc.locked){let t=this.doc.data;this.newDocument(),this.$textarea.val(t)}}lockDocument(){this.doc.save(this.$textarea.val(),(t,e)=>{if(t)this.showMessage(t.message,"error");else if(e){this.$code.html(e.value),this.setTitle(e.key);let t=this.baseUrl+e.key;e.language&&(t+="."+this.lookupExtensionByType(e.language)),window.history.pushState(null,this.appName+"-"+e.key,t),this.fullKey(),this.$textarea.val("").hide(),this.$box.show().focus(),this.addLineNumbers(e.lineCount)}})}configureButtons(){this.buttons=[{$where:$("#box2 .save"),label:"Save",shortcutDescription:"control + s",shortcut:t=>t.ctrlKey&&83===t.keyCode,action:()=>{""!==this.$textarea.val().replace(/^\s+|\s+$/g,"")&&this.lockDocument()}},{$where:$("#box2 .new"),label:"New",shortcut:t=>t.ctrlKey&&78===t.keyCode,shortcutDescription:"control + n",action:()=>{this.newDocument(!this.doc.key)}},{$where:$("#box2 .duplicate"),label:"Duplicate & Edit",shortcut:t=>this.doc.locked&&t.ctrlKey&&68===t.keyCode,shortcutDescription:"control + d",action:()=>{this.duplicateDocument()}},{$where:$("#box2 .raw"),label:"Just Text",shortcut:t=>t.ctrlKey&&t.shiftKey&&82===t.keyCode,shortcutDescription:"control + shift + r",action:()=>{window.location.href=this.baseUrl+"raw/"+this.doc.key}},{$where:$("#box2 .twitter"),label:"Twitter",shortcut:t=>this.options.twitter&&this.doc.locked&&t.shiftKey&&t.ctrlKey&&84==t.keyCode,shortcutDescription:"control + shift + t",action:()=>{window.open("https://twitter.com/share?url="+encodeURI(window.location.href))}}];for(let t=0;t<this.buttons.length;t++)this.configureButton(this.buttons[t])}configureButton(t){t.$where.click(function(e){e.preventDefault(),!t.clickDisabled&&$(this).hasClass("enabled")&&t.action()}),t.$where.mouseenter(function(){$("#box3 .label").text(t.label),$("#box3 .shortcut").text(t.shortcutDescription||""),$("#box3").show(),$(this).append($("#pointer").remove().show())}),t.$where.mouseleave(function(){$("#box3").hide(),$("#pointer").hide()})}configureShortcuts(){$(document.body).keydown(t=>{for(let e of this.buttons||[])if(e.shortcut&&e.shortcut(t)){t.preventDefault(),e.action();return}})}}$(function(){$("textarea").keydown(function(t){if(9===t.keyCode){if(t.preventDefault(),document.selection)this.focus(),document.selection.createRange().text="  ",this.focus();else if(this.selectionStart||"0"==this.selectionStart){let t=this.selectionStart,e=this.selectionEnd,s=this.scrollTop;this.value=this.value.substring(0,t)+"  "+this.value.substring(e,this.value.length),this.focus(),this.selectionStart=t+2,this.selectionEnd=t+2,this.scrollTop=s}else this.value+="  ",this.focus()}})});//# sourceMappingURL=application.min.js.map